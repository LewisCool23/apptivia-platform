const fs = require('fs');
const path = require('path');
const PDFDocument = require('pdfkit');

const outputPath = path.resolve(__dirname, '..', 'docs', 'Apptivia_Permissions_Structure.pdf');

const doc = new PDFDocument({
  size: 'LETTER',
  margin: 48,
  info: {
    Title: 'Apptivia Permissions Structure',
    Author: 'Apptivia Platform',
  },
});

const stream = fs.createWriteStream(outputPath);
doc.pipe(stream);

// Header
const headerColor = '#1f3a8a';
const textColor = '#111827';
const mutedColor = '#6b7280';


doc.font('Helvetica-Bold').fontSize(22).fillColor(headerColor).text('Apptivia Permissions Structure');
doc.moveDown(0.5);
doc.font('Helvetica').fontSize(11).fillColor(mutedColor).text('January 30, 2026');
doc.moveDown(1);

// Overview

doc.font('Helvetica-Bold').fontSize(14).fillColor(textColor).text('Overview');
doc.moveDown(0.4);
doc.font('Helvetica').fontSize(11).fillColor(textColor).text(
  'This document summarizes role-based access across the Apptivia Platform. Permissions are applied per role with optional per-user overrides managed by admins.'
);
doc.moveDown(1);

function sectionTitle(title) {
  doc.font('Helvetica-Bold').fontSize(13).fillColor(textColor).text(title);
  doc.moveDown(0.4);
}

function bullet(text) {
  doc.circle(doc.x + 2, doc.y + 4, 2).fill(textColor);
  doc.fillColor(textColor).font('Helvetica').fontSize(10).text(text, doc.x + 10, doc.y - 6, { continued: false });
  doc.moveDown(0.3);
}

// Roles
sectionTitle('Admin');
bullet('Full access to all pages, filters, and system settings.');
bullet('Can configure scorecards, KPI libraries, integrations, and permissions.');
bullet('Can create/edit contests, teams, and team members.');
bullet('Defaults to all data on login.');
bullet('Access to organization-wide notifications.');

doc.moveDown(0.6);
sectionTitle('Manager');
bullet('Access to all pages with data scoped to assigned team.');
bullet('Can use filters within the assigned team and view Team Snapshot.');
bullet('Can create/edit contests and manage team members.');
bullet('Coach workflow for reps flagged as needing coaching.');
bullet('Receives team notifications only.');

doc.moveDown(0.6);
sectionTitle('Coach');
bullet('Lite Manager permissions for team coaching and progress tracking.');
bullet('Access to team-scoped analytics, coach insights, and contests.');
bullet('Receives team notifications only.');

doc.moveDown(0.6);
sectionTitle('Power User');
bullet('Personalized dashboards with default filters set to the logged-in user.');
bullet('Can view own scorecard/coach insights and join/withdraw contests.');
bullet('No scorecard configuration access.');
bullet('Notifications limited to personal performance updates.');

// Permissions

doc.addPage();
sectionTitle('Core Permissions');
[
  'View Dashboard',
  'View Coach',
  'View Contests',
  'View Analytics',
  'View Systems',
  'View Profile',
  'Export Data',
].forEach(item => bullet(item));

sectionTitle('Administrative Permissions');
[
  'Configure Scorecard',
  'Manage KPI Library',
  'Manage Integrations',
  'Manage Teams',
  'Manage Team Members',
  'Manage Permissions',
].forEach(item => bullet(item));

sectionTitle('Coaching & Team Permissions');
[
  'View Team Snapshot',
  'Coach Team Members',
  'View Team Data',
  'View All Data (admin only)',
].forEach(item => bullet(item));

sectionTitle('Contest Permissions');
[
  'Create Contests',
  'Edit Contests',
  'Join Contests',
  'Withdraw From Contests',
].forEach(item => bullet(item));

sectionTitle('Notification Scopes');
[
  'Self notifications: Power Users and above',
  'Team notifications: Managers and Coaches',
  'Organization notifications: Admins',
].forEach(item => bullet(item));

// Footer

doc.moveDown(1.5);
doc.font('Helvetica').fontSize(9).fillColor(mutedColor).text('Generated by Apptivia Platform', { align: 'center' });

doc.end();

stream.on('finish', () => {
  console.log(`PDF created at ${outputPath}`);
});
